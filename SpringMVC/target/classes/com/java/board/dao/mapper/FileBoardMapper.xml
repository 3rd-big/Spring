<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.java.board.dao.mapper.FileBoardMapper">

	<!-- DB 컬럼명과 변수명을 매칭 <> 규칙 -->
	<resultMap type="com.java.board.dto.FileBoardDto" id="board_dto">
		<result column="BOARD_NUMBER" property="boardNumber"/>
		<result column="WRITER" property="writer"/>
		<result column="SUBJECT" property="subject"/>
		<result column="EMAIL" property="email"/>
		<result column="CONTENT" property="content"/>
		<result column="PASSWORD" property="password"/>
		<result column="WRITE_DATE" property="writeDate"/>
		<result column="READ_COUNT" property="readCount"/>
		<result column="GROUP_NUMBER" property="groupNumber"/>
		<result column="SEQUENCE_NUMBER" property="sequenceNumber"/>
		<result column="SEQUENCE_LEVEL" property="sequenceLevel"/>
		<result column="FILE_NAME" property="fileName"/>
		<result column="PATH" property="path"/>
		<result column="FILE_SIZE" property="fileSize"/>
	</resultMap>
	
	<insert id="fileBoard_insert" parameterType="com.java.board.dto.FileBoardDto">
		insert into board
		VALUES(
				#{boardNumber},
				#{writer},
				#{subject},
				#{email},
				#{content},
				#{password},
				sysdate,
				0,
				#{groupNumber},
				#{sequenceNumber},
				#{sequenceLevel},
				#{fileName},
				#{path},
				#{fileSize}
				)
	</insert>
	
	<select id="fileBoard_list" resultMap="board_dto">
		select *
		from board
		order by group_number desc, sequence_number
	</select>

	<select id="fileBoard_select" parameterType="int" resultMap="board_dto">
		select *
		from board
		where BOARD_NUMBER = #{boardNumber}
	</select>
	
	<select id="boardNumberCheck" resultType="String">
		select BOARD_NUM_SEQ.nextval from dual
	</select>
	
	<update id="sequenceNumber_update" parameterType="java.util.Map">
		update board
		set sequence_number = sequence_number + 1
		where group_number = #{groupNumber}
	</update>
	
	<select id="sequenceCheck" parameterType="java.util.Map" resultType="String">
		select count(*)
		from board
		where sequence_number = #{sequenceNumber} and group_number = #{groupNumber}
	</select>
</mapper>